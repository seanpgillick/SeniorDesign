{% include "layout.html" %}
{% block content %}
    <div class="site-header-logo">
        <h1 class="text-center">
            Graphs
        </h1>
    </div>

    <!-- <div id="selections" class="flex-container"> -->
    <div id="cityForm">
        
        <div id="city-select">
            <label for="cities-select">Select a City</label>
            <select name="city" id="cities-select" class="form-select w-25">
                {% for o in cities %}
                    <option value="{{ o }}">{{ o }}</option>
                {% endfor %}
            </select>
            
        </div>
        <button class="btn btn-primary" id="formButton">
            submit
        </button>
    </div>
    <!-- </div> -->

    <br/>
    <div id="cityRenderStatus" >
    </div>

    <div id="graph-results" hidden="hidden">
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#year-select" aria-expanded="false" aria-controls="collapseExample">
            Filters
        </button>
        <div id="year-select" class="collapse">
            <label for="cities-select">Select Years</label>
            {% for o in years %}
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" value="{{o}}">
                    <label class="form-check-label" for="inlineCheckbox1">{{o}}</label>
                </div>
            {% endfor %}

            <button class="btn btn-secondary" type="button" >
                Apply Filters
            </button>
        </div>
        <div class="row container text-center">
            <div class="col card">
                <div id="chart1"></div>
            </div>
            <div class="col card">
                <div id="chart2"></div> 
            </div>
        </div>
    
        <br/>
        <hr/>
        <table class="table">
            <thead>
                <tr>
                <th scope="col">#</th>
                <th scope="col">Crime</th>
                <th scope="col">Year</th>
                <th scope="col">City</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                <th scope="row">1</th>
                </tr>
                <tr>
                <th scope="row">2</th>
                </tr>
                <tr>
                <th scope="row">3</th>
                </tr>
            </tbody>
        </table>
    </div>
    <br/>
    <div class="container text-center">
        <div class="row">
        
            <!-- <div class="col card">
                <div id="chart1"></div>

            </div>

            <div class="col card">
                <div id="chart2"></div>
                
            </div> -->

        <!-- <div class="card mb-4 m-auto" style="width: 90%;">
            <div class="card-body">
                <div id="chart3"></div>
            </div>
            </div>
        </div>-->
        </div>
    </div>


    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#formButton").click(function() {
                document.getElementById("cityRenderStatus").innerHTML=`<div>Loading Graphs...</div>`
                console.log($("#cities-select").val())
                const cityName =$("#cities-select").val()
                console.log(cityName)
                const graph_url = {{ url_for("graphResults")|tojson }};
                console.log(graph_url)
                // const graph_div = document.getElementById("graph-results");
                // console.log(graph_div)
                fetch("http://127.0.0.1:2000/graphResults/"+cityName)
                    .then((res) => {
                        if (!res.ok) {
                            throw new Error("HTTP error " + res.status)
                        }
                        console.log(res)
                        return res.text();
                    })
                    .then((data) => {
                        // var finalData=JSON.parse(data)
                        // document.getElementById("chart1").innerHTML=data
                        // document.getElementById("chart2").innerHTML=data[1]
                        // console.log(finalData[0]["data"])
                        document.getElementById("graph-results").removeAttribute("hidden");

                        Plotly.plot("chart1", JSON.parse(JSON.parse(data)[0]),{});
                        Plotly.plot("chart2", JSON.parse(JSON.parse(data)[1]),{});
                        // Plotly.plot("chart3", JSON.parse(JSON.parse(data)[2]),{});
                        document.getElementById("cityRenderStatus").innerHTML=``

                    })
                    .catch((err) => {
                        console.log(err);
                        document.getElementById("cityRenderStatus").innerHTML=`<div>Error loading graphs</div>`

                    });

                // .then(response => console.log(response.text()))
                    // .then(text => graph_div.innerHtml = text)
                    
                //     console.log("Hey There")
                // graph_div.innerHTML="<div>Hello There</div>"
            });
            
        });
        

        
    </script>

{% endblock %}