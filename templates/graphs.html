{% block content %}

<div class="mx-auto align-items-center no-pad" id="graph-results" style="width: 90%;">
    <div id="cityRenderStatus">
    </div>

            <!-- FACTS -->
    <div class="row container-center text-center g-4">
        <div class="col-md-12 card">
            <div class="card-header">             
                <h2>{{city}} Crime Rate By Year</h2>
            </div>
            <div class="blog-post card-effect text-center container">
                <div class="row">
                    <div class="col-8">
                        <div  id="chart4"></div>
                    </div>
                    <div class="col-4 d-flex align-items-center">
                        {% for o in crimeRates %}
                            {% if o.year=="total" %}
                            <div class="col">
                                <h2 value="{{ o }}"><span class="bigNum">{{o.rate}}</span>/100</h2>
                                <h6> are victims of a crime in a given year</h6>
                                <hr/>
                                <div><span class="bigNum">{{violentPercent}}%</span> - From Violent Crimes</div>
                                <div><span class="bigNum">{{propertyPercent}}%</span> - From Property Crimes</div>
                                <div><span class="bigNum">{{otherPercent}}%</span> - From Other crimes</div>
                            </div>
                            {% endif %}

                        {% endfor %}
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <br/>

    <div class="row container-center text-center g-4">
        <div class="col-md-12 card">
            <div class="card-header text-center">
                <h3>{{city}} Compared to Top Cities in U.S.</h3>
            </div>
            <div class="blog-post card-effect text-center">
                <div id="chart3Load"></div>
                <div id="chart3"></div>
                <p>A bar graph is a powerful tool for visualizing data, and when it comes to tracking crime rates in US
                    cities. As your eyes scan from left to right, you might see bars that are shorter or taller
                    depending on
                    the severity of crime in each city </p>
            </div>
        </div>
    </div>

    <div class="row container-center text-center g-4">
        <div class="col-md-6 card">
            <div class="card-header">
                <h3>{{city}} Crime Types {% if compCity %} in {{pieYears}} {% endif %}</h3>
            </div>
            <div class="blog-post card-effect">
                <div id="chart1"></div>
                <br />
                <div id="year-select">
                    <label for="years-select">Select Years: </label>
                    {% for o in years %}
                    <div class="form-check form-check-inline">
                        
                        <input class="form-check-input yearsCheck" type="checkbox" value="{{o}}" checked>
                        

                        <label class="form-check-label" for="inlineCheckbox1">{{o}}</label>
                    </div>
                    {% endfor %}
                    <div id="chart1Load"></div>

                    <!--<button class="btn btn-primary no-pad" type="button" id="updateYearsComp">
                        Set Years
                    </button>-->
                </div>
                <p>Each slice of the pie represents a category of crime, and the size of the slice corresponds to the
                    proportion of that category in relation to the total.
                    This represents the types of crimes are most common in the city. Please select year if you want to
                    see yearly type of crimes data.
                </p>
            </div>
        </div>
        <div class="col-md-6 card">
            <div class="card-header">

                <h3 id="compareTitle" class="hidden">Comparing {{city}} to {{compCity}}</h3>

                <h3 id="yearlyTitle">{{city}} Yearly Crime Count</h3>

            </div>

            <div class="blog-post card-effect">
                <div id="chart2" ></div>
                <br />
                <div id="city-select">
                    <label for="cities-comp-select">Select a City to Compare: </label>
                    <select name="city" id="cities-comp-select" class="form-select w-25" style="display: inline;">
                        {% for o in cities %}
                        <option value="{{ o }}">{{ o }}</option>
                        {% endfor %}
                    </select>
                    <button class="btn btn-primary no-pad" type="button" id="updateCityComp">
                        Compare
                    </button>
                </div>
                <div id="chart2Load"></div>





                <p id="compareText" class="hidden">Comparing crime rates between two cities can provide valuable
                    information about the relative
                    safety of each city.
                    By analyzing crime data from both cities, we can identify patterns and trends that may indicate
                    areas of concern or success
                    in each city's approach to crime prevention.</p>

                <p id="yearlyText">Yearly crimes can provide important information about trends in crime
                    over time.
                    By tracking the number of crimes committed each year, we can identify patterns and changes in
                    the prevalence of different
                    types of crimes, as well as changes in the overall level of crime.</p>

                <button class="btn btn-secondary hidden no-pad" type="button" id="yearly_count">Remove Comparison</button>

            </div>
        </div>
    </div>
    <br />
    <hr />

    <div class="row container-center text-center g-4">
        <div class="col-md-12 card">            
            <div class="card-header text-center">
                <h2>CrimeList</h2>
            </div>
        
            <div class="blog-post card-effect text-center">
                {% include "crimelist.html" %}
            </div>
        </div>
    </div>



</div>
<script type="text/javascript">



    var layout = {
        autosize: false,
        width: 200,
        height: 0,
        margin: {
            l: 0,
            r: 0,
            b: 10,
            t: 10,
            pad: 4
        },
        
    };

    var config = { responsive: true }

    $(document).ready(function () {
        var graphs1 = {{ graph1JSON | safe
    }};
    Plotly.newPlot("chart1", graphs1, layout, config);

    var graphs2 = {{ graph2JSON | safe}};
    Plotly.newPlot("chart2", graphs2, layout, config);

    var graphs3 = {{ graph3JSON | safe}};
    Plotly.newPlot("chart3", graphs3, layout, config);

    var graphs4 = {{ graph4JSON | safe}};
    Plotly.plot("chart4", graphs4,{});


    $(".yearsCheck").click(function () {
        yearsSelected = $('.yearsCheck:checkbox:checked')
        
        let years = []
        if (yearsSelected.length > 0) {
            for (let x = 0; x < yearsSelected.length; x++) {
                console.log(yearsSelected[x].value)
                years.push(yearsSelected[x].value)
            }
        }
        else {
            document.getElementById("chart1Load").innerHTML = `<div>Please select a year</div>`
            return;
            /*yearsSelected = $('.yearsCheck:checkbox')
            for (let x = 0; x < yearsSelected.length; x++) {
                years.push(yearsSelected[x].value)
            }*/
        }

        document.getElementById("chart1Load").innerHTML = `<div>Loading Graphs...</div>`
        let url = ""
        if ("{{compCity}}") {
            url = "/analysis/{{city}}/{{tab}}/enhanceGraphs/pieYears=" + years + "compCity={{compCity}}"
        } else {
            url = "/analysis/{{city}}/{{tab}}/enhanceGraphs/pieYears=" + years
        }

        $.get(url, null, (graph) => {

            $('#chart1Load').empty();
            var graphs1 = JSON.parse(graph);
            Plotly.newPlot("chart1", graphs1, {});
        });

        /*fetch(url)
            .then((res) => {
                if (!res.ok) {
                    throw new Error("HTTP error " + res.status)
                }
                console.log(res)
                //document.getElementById("chart1Load").innerHTML=``
                window.location.replace(res.url)

            })
            .catch((err) => {
                console.log(err);
                document.getElementById("chart1").innerHTML = `<div>Error loading graphs</div>`

            });*/

    });

    $("#updateCityComp").click(function () {
        const cityComp = $("#cities-comp-select").val()
        document.getElementById("chart2Load").innerHTML = `<div>Loading Graphs...</div>`
        let url = ""
        console.log(cityComp)
        if ("{{pieYears}}") {
            console.log("{{pieYears}}")
            url = "/analysis/{{city}}/{{tab}}/enhanceGraphs/pieYears={{pieYears}}compCity=" + cityComp
        } else {
            url = "/analysis/{{city}}/{{tab}}/enhanceGraphs/compCity=" + cityComp
        }
        $.get(url, null, (graph) => {

            var graphs1 = JSON.parse(graph);
            $('#chart2').empty();
            $('#chart2Load').empty();
            Plotly.newPlot("chart2", graphs1, {});

            $('#yearlyTitle').hide();
            $('#yearlyText').hide();

            $('#compareTitle').show().text("Comparing {{city}} to " + cityComp);
            $('#compareText').show();
            $('#yearly_count').show();
        });

    });

    $("#yearly_count").click(function () {

        url = "/analysis/{{city}}/{{tab}}/enhanceGraphs/compCity=Yearly"

        $.get(url, null, (graph) => {

            $('#chart2Load').empty();
            var graphs1 = JSON.parse(graph);
            Plotly.newPlot("chart2", graphs1, {});

            $('#yearlyTitle').show();
            $('#yearlyText').show();

            $('#compareTitle').hide()
            $('#compareText').hide();
            $('#yearly_count').hide();
        });

    });
            
        });



</script>
{% endblock %}
